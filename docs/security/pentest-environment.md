# External Penetration Test Environment Configuration

**Document ID:** SEC-PENTEST-ENV-001
**Version:** 1.0
**Effective Date:** February 7, 2026
**Classification:** Internal - Confidential
**Related Documents:** SEC-PENTEST-001, SEC-PENTEST-SCOPE-001

---

## 1. Purpose and Overview

This document provides comprehensive configuration and provisioning details for the Healthcare AI Assistant penetration testing environment. The penetration test environment must accurately mirror production capabilities while protecting sensitive data and ensuring testing activities do not impact production systems or expose PHI.

The environment configuration strategy recognizes that effective penetration testing requires realistic testing conditions that reproduce production attack surfaces while implementing appropriate safeguards for sensitive data. This document details the technical configuration, data preparation, access provisioning, and environment management procedures required for successful penetration testing.

The penetration test environment serves as a controlled testing ground where security assessments can be conducted safely without risking production data exposure or service disruption. Environment preparation is a critical prerequisite that must be completed before the engagement begins.

---

## 2. Environment Architecture

### 2.1 Environment Strategy

The penetration testing environment is configured as an isolated staging environment that mirrors production capabilities while implementing data protection measures.

**Primary Environment:** Staging environment configured with identical architecture to production
**Data Strategy:** Sanitized production-like data with synthetic PHI for realistic testing
**Isolation:** Complete network and data isolation from production systems
**Access:** Limited scope test accounts with controlled privileges

### 2.2 Environment Comparison Matrix

| Component | Production | Staging (Pen Test) | Notes |
|-----------|------------|--------------------|-------|
| Application Version | Latest Stable | Matching Production | Must be synchronized |
| Database | Supabase Production | Separate Staging Instance | No data sharing |
| LLM Integration | OpenAI Production | OpenAI Production API | Isolated usage tracking |
| Authentication | NextAuth Production | Matching Configuration | Separate user store |
| Rate Limiting | Enabled | Enabled | Matching configuration |
| Monitoring | Full Monitoring | Monitoring Enabled | Separate alerting |
| SSL/TLS | Valid Certificates | Valid Certificates | Matching configuration |

### 2.3 Environment Diagram

```
Production Environment                    Staging (Pen Test) Environment
┌─────────────────────────────────┐      ┌─────────────────────────────────┐
│    Vercel Production            │      │    Vercel Staging              │
│    ─────────────────            │      │    ─────────────────           │
│    • Production Deployment     │      │    • Staging Deployment        │
│    • Production Domain         │      │    • Staging Domain            │
│    • Full Feature Set          │      │    • Identical Feature Set     │
└─────────────────────────────────┘      └─────────────────────────────────┘
              │                                    │
              │ No Data Flow                       │ No Data Flow
              ▼                                    ▼
┌─────────────────────────────────┐      ┌─────────────────────────────────┐
│    Supabase Production          │      │    Supabase Staging            │
│    ─────────────────            │      │    ─────────────────           │
│    • Production Database       │      │    • Staging Database          │
│    • Real PHI Data             │      │    • Sanitized Data            │
│    • Production RLS Policies   │      │    • Matching RLS Policies     │
└─────────────────────────────────┘      └─────────────────────────────────┘
              │                                    │
              │                                    │
              ▼                                    ▼
┌─────────────────────────────────┐      ┌─────────────────────────────────┐
│    External Services           │      │    External Services           │
│    ─────────────────            │      │    ─────────────────           │
│    • OpenAI API                │      │    • OpenAI API (Separate Key) │
│    • Monitoring Services       │      │    • Separate Monitoring       │
│    • PagerDuty                  │      │    • Separate PagerDuty         │
└─────────────────────────────────┘      └─────────────────────────────────┘
```

---

## 3. Environment Provisioning

### 3.1 Infrastructure Provisioning

The staging environment infrastructure must be provisioned to match production configuration.

**Vercel Deployment Configuration:**

The Vercel staging deployment must be configured with identical settings to production with the following specific configurations. The staging deployment must use the Vercel Enterprise plan with Secure Compute add-on enabled. Environment variables must be configured with staging-specific values that do not expose production credentials. The deployment must use a separate domain or subdomain specifically designated for penetration testing (e.g., pentest.healthcare-ai.example.com).

The deployment configuration must enable all security features including rate limiting, PHI detection, and injection blocking at matching configuration levels. Monitoring and alerting must be configured to capture penetration test activities without triggering inappropriate security responses.

**Database Instance Provisioning:**

A separate Supabase instance must be provisioned for the staging environment. The instance must use the same configuration as production including PostgreSQL version, pgvector extension, and RLS policy configuration. The instance must be provisioned in the same region as production for realistic performance characteristics.

Database credentials must be separate from production with no cross-access capability. Backup and recovery procedures must be configured for the staging instance with appropriate retention.

### 3.2 Network Configuration

Network configuration must ensure complete isolation between production and staging environments.

**DNS Configuration:**

A dedicated subdomain must be configured for penetration testing access. The subdomain (pentest.healthcare-ai.example.com) must resolve to the staging environment. DNS configuration must prevent accidental access to staging through production domain paths.

**Firewall and Access Control:**

Network firewall rules must restrict staging access to penetration testing team IP addresses where possible. Access must be limited to required ports and protocols. Any production network access from staging must be explicitly blocked.

**SSL/TLS Configuration:**

Valid SSL/TLS certificates must be configured for the staging domain with identical security settings to production. Certificate validation and security headers must match production configuration.

### 3.3 Application Configuration

Application-level configuration must match production while accommodating testing requirements.

**Environment Variables:**

The following environment variables must be configured for the staging environment with staging-specific values:

| Variable | Production Value | Staging Value | Notes |
|----------|-----------------|---------------|-------|
| DATABASE_URL | [Production URL] | [Staging URL] | Separate database instance |
| OPENAI_API_KEY | [Production Key] | [Staging Key] | Separate API key for tracking |
| NEXTAUTH_SECRET | [Production Secret] | [Staging Secret] | Different secret value |
| RATE_LIMIT_STRATEGY | production | testing | Enables verbose logging |
| PHI_DETECTION_MODE | enforce | monitor-log | Logging mode for analysis |
| AUDIT_LOG_RETENTION | 6 years | 1 year | Reduced retention for staging |

**Feature Flags:**

All production feature flags must be enabled in staging to ensure identical functionality. Any testing-specific flags must be clearly documented and disabled before production deployment.

---

## 4. Test Data Configuration

### 4.1 Data Strategy Overview

The penetration testing environment requires realistic data for effective testing while protecting sensitive information.

**Production Data Relationship:** No production data, including PHI, may be copied to or accessed from the staging environment. This is a critical requirement for HIPAA compliance and data protection.

**Synthetic Data Approach:** The staging environment uses synthetic data that mimics production data characteristics without containing actual PHI or sensitive information.

### 4.2 Synthetic PHI Data Generation

Synthetic PHI data must be generated for realistic testing of PHI detection and data protection controls.

**PHI Pattern Categories:**

The following PHI categories must be represented in synthetic test data with realistic patterns that enable testing of detection systems:

Social Security Numbers must be generated using valid format (XXX-XX-XXXX) with synthetic numbers that do not correspond to real individuals. Test patterns should include standard format, formatted with spaces, formatted with dashes, and partial SSN patterns.

Medical Record Numbers must be generated using realistic MRN formats typical of healthcare organizations. Multiple MRN formats should be included to test detection across different patterns.

Dates of Birth must be generated across realistic age ranges with various date formats. Both full dates and year-only representations should be included.

Phone numbers must include various formats including standard 10-digit, international formats, and partial patterns. All numbers must be synthetic and non-functional.

Email addresses must use realistic formats with synthetic domains. Email addresses should include variations in formatting and encoding.

Physical addresses must include realistic address formats across different regions. Addresses should use fictional street names and locations while maintaining realistic structure.

**Synthetic Document Generation:**

A library of synthetic clinical documents must be generated for RAG pipeline testing. Documents should include realistic clinical language without actual patient information. Document types should include progress notes, discharge summaries, lab reports, imaging reports, and clinical correspondence.

Each synthetic document should contain embedded synthetic PHI for testing PHI detection within document contexts. The synthetic documents should be tagged with metadata indicating they are test data.

### 4.3 Test Account Configuration

Test accounts with limited scope must be provisioned for penetration testing activities.

**Account Categories:**

The following test account categories must be provisioned with appropriate privileges for testing:

| Account Type | Purpose | Privileges | Limitations |
|--------------|---------|------------|-------------|
| PENTEST_READONLY | Read-only testing | Document read, chat access | No write operations |
| PENTEST_USER | Standard user testing | Full user privileges | No admin access |
| PENTEST_PROVIDER | Provider role testing | Full provider privileges | No organization management |
| PENTEST_ADMIN | Admin testing | Administrative privileges | Restricted to staging scope |
| PENTEST_EMERGENCY | Emergency access testing | Emergency access privileges | Time-limited, logged |

**Account Security:**

All test accounts must use standardized, documented credentials that are rotated after the engagement. Accounts must be clearly marked as test accounts in all systems. Account creation, modification, and deletion must be logged to audit trail.

### 4.4 Test Organization Configuration

A dedicated test organization must be configured for penetration testing activities.

**Organization Configuration:**

The test organization (ORG_PENTEST) must be configured with realistic organizational settings matching production configuration. The organization must have a dedicated subscription plan, rate limiting configuration, and monitoring settings.

Organization membership must be limited to test accounts with clear documentation of account ownership and purpose. Organization-scoped settings must be configured for realistic testing conditions.

---

## 5. Access Configuration

### 5.1 Credential Management

Test account credentials must be managed securely with appropriate access controls.

**Credential Storage:**

Test account credentials must be stored in a secure password manager accessible only to authorized penetration testing personnel. Credentials must not be shared through unencrypted channels. Credentials must be provided to the testing vendor through secure transfer mechanisms.

**Credential Format:**

Test account credentials must use the following standardized format for easy identification:

| Account | Username | Password | Notes |
|---------|----------|----------|-------|
| Read-Only | pentest_readonly@healthcare-ai.example.com | [Complex password] | Document read access |
| Standard User | pentest_user@healthcare-ai.example.com | [Complex password] | Full user privileges |
| Provider | pentest_provider@healthcare-ai.example.com | [Complex password] | Clinical workflows |
| Administrator | pentest_admin@healthcare-ai.example.com | [Complex password] | Admin privileges |
| Emergency | pentest_emergency@healthcare-ai.example.com | [Complex password] | Emergency access |

### 5.2 Access Provisioning Procedures

Access provisioning must follow documented procedures to ensure appropriate access control.

**Pre-Engagement Access Provisioning:**

Seven days before the engagement, test accounts must be created and configured. Credentials must be generated and stored securely. Access permissions must be verified for each account type.

The staging environment must be configured to accept test account authentication. Monitoring must be configured to identify test account activities.

**During Engagement Access Management:**

Any additional access required during the engagement must be requested through the designated security contact. Access requests must be evaluated for necessity and risk. Approved additional access must be documented and tracked.

**Post-Engagement Access Revocation:**

Within 24 hours of engagement completion, all test accounts must be disabled. Within 72 hours of engagement completion, all test accounts must be deleted. Credentials must be rotated for any production credentials that may have been exposed during testing.

### 5.3 VPN and Network Access

If VPN access is required for testing, the following procedures apply.

**VPN Configuration:**

A dedicated VPN profile must be configured for penetration testing team access. VPN access must be restricted to required IP ranges. VPN credentials must be time-limited and automatically revoked after the engagement.

**Split Tunneling:**

VPN configuration must prevent split tunneling that could expose production systems. All traffic must route through the VPN for testing isolation.

---

## 6. Monitoring and Logging Configuration

### 6.1 Testing Activity Monitoring

The staging environment must be configured to capture comprehensive monitoring data during penetration testing activities.

**Penetration Test Identification:**

All penetration testing activities must be tagged in monitoring systems to distinguish from potential security incidents. Tagging enables appropriate alert configuration and prevents misclassification of testing activities as attacks.

**Alert Configuration:**

Security alerts must be configured with awareness of ongoing penetration testing. Critical alerts must still fire for significant anomalies while informational alerts may be suppressed to reduce noise. Alert suppression must be documented and time-limited.

### 6.2 Audit Logging Configuration

Comprehensive audit logging must be enabled in the staging environment for the penetration test engagement.

**Logging Scope:**

Audit logging in staging must capture all activities that would be logged in production. This includes authentication events, authorization decisions, PHI access events, API calls, and administrative actions.

**Log Retention:**

Staging audit logs must be retained for the duration of the engagement plus 90 days to support findings analysis and verification activities.

**Log Analysis:**

Audit logs must be analyzed during and after the engagement to support findings identification and remediation verification.

### 6.3 Communication Channel Setup

Effective communication channels must be established before the engagement begins.

**Primary Communication:**

Primary communication between the testing team and organization must use secure email (pentest-security@healthcare-ai.example.com) for non-urgent matters. Response time expectation is four hours during business hours.

**Urgent Communication:**

Urgent communication must use the designated Slack channel (#pentest-communications) for real-time coordination. The security team lead must be available by phone for critical issues.

**Finding Notification:**

Critical and high-severity findings must be communicated immediately through the urgent communication channel. The notification must include finding description, severity, and immediate containment recommendations.

---

## 7. Environment-Specific Configurations

### 7.1 Rate Limiting Test Configuration

The rate limiting configuration in staging must enable thorough testing while providing realistic behavior.

**Rate Limit Values:**

Staging rate limits should match production configuration to enable accurate testing of rate limiting effectiveness:

| Tier | Production Limit | Staging Limit | Notes |
|------|-----------------|---------------|-------|
| Organization | 1,000 requests/minute | 1,000 requests/minute | Matching configuration |
| User | 60 requests/minute | 100 requests/minute | Elevated for testing |
| Session | 10 concurrent | 10 concurrent | Matching configuration |

**Abuse Detection Configuration:**

Abuse detection should be enabled in staging with full logging for testing purposes. The abuse detection thresholds should match production to enable accurate testing of detection effectiveness.

### 7.2 Security Control Configuration

All security controls must be enabled in staging with configuration matching production.

**PHI Detection Configuration:**

PHI detection should be configured in "monitor-log" mode for the engagement. This mode enables comprehensive testing of detection capabilities while logging all detection events for analysis. The configuration must capture both detected PHI and detection accuracy metrics.

**Injection Blocking Configuration:**

Injection blocking should be configured in "enforce" mode for the engagement. This mode enables testing of blocking effectiveness while protecting staging environment from actual injection exploitation.

**Audit Logging Configuration:**

Audit logging must be configured with enhanced logging for the engagement. All events must be logged with full detail including request/response samples where appropriate.

### 7.3 LLM Integration Configuration

The LLM integration configuration must enable comprehensive AI security testing.

**API Key Configuration:**

A dedicated OpenAI API key must be configured for staging usage. The API key must be scoped to prevent unintended usage. API usage must be monitored for testing activity tracking.

**Model Configuration:**

The LLM model configuration must match production settings including temperature, max tokens, and model version. This ensures testing reflects production behavior and security characteristics.

**Prompt Configuration:**

System prompts must match production configuration for realistic testing of prompt injection and jailbreak attacks.

---

## 8. Environment Validation Procedures

### 8.1 Pre-Engagement Validation Checklist

The following validation procedures must be completed before the penetration test engagement begins.

| Validation Item | Method | Expected Result | Status |
|-----------------|--------|-----------------|--------|
| Staging deployment functional | Smoke test all endpoints | All endpoints respond correctly | ☐ |
| Database connectivity verified | Connection test | Successful connection | ☐ |
| Authentication functional | Login with test accounts | Successful authentication | ☐ |
| Authorization verified | Test account access | Appropriate access enforcement | ☐ |
| Rate limiting functional | Test rate limit enforcement | 429 response at limit | ☐ |
| PHI detection logging | Submit PHI-containing input | Detection logged | ☐ |
| Audit logging functional | Trigger audit event | Event logged correctly | ☐ |
| Monitoring functional | View monitoring dashboard | Metrics displaying | ☐ |
| Alerting functional | Test alert trigger | Alert received | ☐ |
| LLM integration functional | Submit test query | Response received | ☐ |

### 8.2 Environment Readiness Sign-Off

The following roles must sign off on environment readiness before the engagement begins.

| Role | Name | Signature | Date |
|------|------|-----------|------|
| Infrastructure Lead | | | |
| Security Team Lead | | | |
| Operations Lead | | | |
| Compliance Officer | | | |

---

## 9. Environment Management During Engagement

### 9.1 Environment Maintenance

The staging environment must be maintained throughout the engagement to ensure continued functionality.

**Environment Monitoring:**

Environment health must be monitored throughout the engagement. Any degradation must be addressed immediately to prevent testing delays.

**Configuration Changes:**

Configuration changes during the engagement must be documented and communicated. Changes that could impact testing scope or results require approval from the security team lead.

### 9.2 Issue Management

Issues encountered during the engagement must be managed according to established procedures.

**Environment Issues:**

Environment issues including downtime, degradation, or malfunction must be addressed immediately. The testing team must be notified of any environment issues and expected resolution time.

**Scope Issues:**

Any issues requiring scope changes must be addressed through the scope change management process documented in the scope document.

### 9.3 Engagement Completion Procedures

The following procedures must be completed at engagement conclusion.

**Environment Reset:**

The staging environment must be reset to pre-engagement configuration within 72 hours of engagement completion. Test accounts must be deleted. Test data may be retained for 90 days to support remediation verification.

**Documentation:**

All environment changes during the engagement must be documented. Environment configuration should be updated to reflect lessons learned.

**Credential Rotation:**

All credentials provided to the testing vendor must be rotated within 72 hours of engagement completion.

---

## 10. Security Considerations

### 10.1 Data Protection During Testing

Strict data protection measures must be in place throughout the penetration test engagement.

**PHI Protection:**

No PHI from production systems may be accessed, copied, or transmitted during the engagement. All test data must be synthetic and clearly marked as test data. Any suspected PHI exposure must be immediately reported and addressed.

**Data Handling Procedures:**

All testing activities must follow established data handling procedures. Test data must not be transmitted through insecure channels. Test data must be securely deleted after the engagement.

### 10.2 Access Control During Testing

Access controls must remain effective throughout the engagement.

**Least Privilege:**

Testing accounts must follow least privilege principles. Accounts must have only the access required for testing objectives. Elevated privileges must be carefully controlled and monitored.

**Access Review:**

Access must be reviewed throughout the engagement to ensure continued appropriateness. Any access that is no longer required must be revoked immediately.

### 10.3 Confidentiality Measures

Strict confidentiality must be maintained throughout the engagement.

**Information Security:**

All information related to the engagement, including findings, is confidential and must be protected accordingly. Information must be shared only with authorized personnel.

**Document Handling:**

Engagement documents must be handled according to information classification policies. Documents must be stored securely and transmitted through encrypted channels.

---

## 11. Document Control

### 11.1 Revision History

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| 1.0 | February 7, 2026 | Claude | Initial release |

### 11.2 Approvals

| Role | Name | Signature | Date |
|------|------|-----------|------|
| Infrastructure Lead | | | |
| Security Team Lead | | | |
| Compliance Officer | | | |
| Chief Information Security Officer | | | |

---

**Classification:** Internal - Confidential
**Handling Instructions:** This document contains sensitive security configuration information. Distribution is limited to authorized personnel involved in penetration test preparation and execution.
